---
title: iOS ÌîÑÎ°úÍ∑∏ÎûòÎ∞ç Ïã§Î¨¥ 11Ï£ºÏ∞®
author: Ki-Chang Kim (Panther K)
date: 2025-05-14 14:00 +0900
categories: [College, iOS]
tags: [college, ios, swift]
---

## OpenAPI Í∏∞Î∞ò iOS Ïï± Í∞úÎ∞ú

### MovieDataÌòï Íµ¨Ï°∞Ï≤¥

- ```swift
  struct MovieData: Codable {
    let boxOfficeResult: BoxOfficeResult
  }
  
  struct BoxOfficeResult: Codable {
      let dailyBoxOfficeList: [DailyBoxOfficeList]
  }
  
  struct DailyBoxOfficeList: Codable {
      let movieNm: String
      let audiCnt: String
      let audiAcc: String
      let rank: String
  }
  ```
- ÏÑúÎ≤Ñ / APIÏóêÏÑú Î∞õÏïÑÏò§Îäî Îç∞Ïù¥ÌÑ∞Îäî ÏùºÎ∞òÏ†ÅÏúºÎ°ú JSON Ìè¨Îß∑
- Codable ÌîÑÎ°úÌÜ†ÏΩú Ï±ÑÌÉù Ïãú Îã§ÏùåÏùÑ ÏûêÎèôÏúºÎ°ú Ï≤òÎ¶¨Ìï®
  - JSONDecoder ÌÅ¥ÎûòÏä§Í∞Ä JSON -> Íµ¨Ï°∞Ï≤¥ / ÌÅ¥ÎûòÏä§ (ÎîîÏΩîÎî©)
  - JSONEncoder ÌÅ¥ÎûòÏä§Í∞Ä Íµ¨Ï°∞Ï≤¥ / ÌÅ¥ÎûòÏä§ -> JSON (Ïù∏ÏΩîÎî©)

### JSONDecoder

- ```swift
  do {
      let decodedData = try decoder.decode(MovieData.self, from: JSONdata)
      self.movieData = decodedData
      print(decodedData.boxOfficeResult.dailyBoxOfficeList[0].movieNm)
      print(decodedData.boxOfficeResult.dailyBoxOfficeList[0].audiAcc)
  } catch {
      print(error)
  }
  ```
- ![week11-1](/assets/img/post/25-05-14/1.png)
  - ÌÅ¥Î°úÏ†Ä ÎÇ¥Î∂ÄÏóêÏÑú ÌîÑÎ°úÌçºÌã∞ Ï†ëÍ∑º Ïãú self Ï†ëÎëêÏÇ¨Î•º ÏÇ¨Ïö©Ìï¥Ïïº Ìï®
- decode Ïãú Ïò§Î•ò Ï≤òÎ¶¨ ÌïÑÏöî: Do-Try-Catch ÏÇ¨Ïö©

### reloadData()

- Îç∞Ïù¥ÌÑ∞Í∞Ä Î≥ÄÍ≤ΩÎêòÍ±∞ÎÇò ÏÉàÎ°ú Îì§Ïñ¥Ïò® Í≤ΩÏö∞ ÌÖåÏù¥Î∏î Î∑∞ Ï†ÑÏ≤¥Î•º Îã§Ïãú Í∑∏Î¶¨ÎèÑÎ°ù ÏöîÏ≤≠ÌïòÎäî Î©îÏÑúÎìú
- ![](/assets/img/post/25-05-14/2.png)
  - Main Thread Checker: UI API called on a background thread: -[UITableView reloadData]
  - ÏóêÎü¨ Ìï¥ÏÑù: UI APIÍ∞Ä Î∞±Í∑∏ÎùºÏö¥Îìú Ïä§Î†àÎìúÏóêÏÑú Ìò∏Ï∂úÎê®
  - iOS Ïï±ÏóêÏÑú UI Í¥ÄÎ†® ÏûëÏóÖÏùÄ **Î∞òÎìúÏãú** Î©îÏù∏ Ïä§Î†àÎìúÏóêÏÑúÎßå Ìï¥Ïïº Ìï®
  - ```swift
    DispatchQueue.main.async {
        self.table.reloadData()
    }
    ```
    - ÎπÑÎèôÍ∏∞ ÏûëÏóÖ(Î©ÄÌã∞Ïä§Î†àÎî©)ÏùÑ ÏâΩÍ≤å ÏÇ¨Ïö©Ìï† Ïàò ÏûàÍ≤å Ìï¥Ï£ºÎäî Swift ÌÅ¥ÎûòÏä§
      - ÎπÑÎèôÍ∏∞ Ï≤òÎ¶¨: ÏßÄÍ∏à ÎãπÏû• Ïã§ÌñâÌïòÏßÄ ÏïäÍ≥†, ÌÅêÏùò ÎåÄÍ∏∞Ïó¥Ïóê Ï∂îÍ∞Ä, ÌÅêÏóê ÏûàÎäî Îã§Î•∏ ÏûëÏóÖÏù¥ Î™®Îëê ÎÅùÎÇòÎ©¥ ÏûëÏóÖ Ïã§Ìñâ
    - DispatchQueue.mainÏùÄ Ïï±Ïùò Î©îÏù∏ Ïä§Î†àÎìú(UIKit/SwiftUI Îì±ÏóêÏÑú UI Ï°∞ÏûëÏù¥ Ïù¥Î£®Ïñ¥ÏßÄÎäî Í≥≥)Î•º ÏùòÎØ∏

### Ïã§Ìñâ Í≤∞Í≥º

![](/assets/img/post/25-05-14/3.png)

### Ïï± Ïã§Ìñâ Ïãú Ïñ¥Ï†ú ÎÇ†ÏßúÎ°ú ÏûêÎèô Ï°∞Ìöå

- ```swift
  var movieURL = "https://kobis.or.kr/kobisopenapi/webservice/rest/boxoffice/searchDailyBoxOfficeList.json?key=[KEY]&targetDt="
    
  override func viewDidLoad() {
      super.viewDidLoad()
      table.delegate = self
      table.dataSource = self
      
      movieURL += makeYesterdayString()
      getData()
  }
  
  func makeYesterdayString() -> String {
      let y = Calendar.current.date(byAdding: .day, value: -1, to: Date())!
      let dateF = DateFormatter()
      dateF.dateFormat = "yyyyMMdd"
      let day = dateF.string(from: y)
      return day
  }
  ```

### Stack View

![](/assets/img/post/25-05-14/4.png)

![](/assets/img/post/25-05-14/5.png)

### ÎàÑÏ†Å Í¥ÄÍ∞ù Ïàò / Ïñ¥Ï†ú Í¥ÄÍ∞ù Ïàò Ï∂îÍ∞Ä

- MyTableViewCell
  ```swift
  @IBOutlet weak var audiAccumulate: UILabel!
  @IBOutlet weak var audiCount: UILabel!
  ```
- ViewController
  ```swift
  cell.audiAccumulate.text = movieData?.boxOfficeResult.dailyBoxOfficeList[indexPath.row].audiAcc
  cell.audiCount.text = movieData?.boxOfficeResult.dailyBoxOfficeList[indexPath.row].audiCnt
  ```

#### Í≤∞Í≥º

![](/assets/img/post/25-05-14/6.png)

### Ï∂îÍ∞Ä ÏûëÏóÖ

- ```swift
  func tableView(_ tableView: UITableView, titleForHeaderInSection section: Int) -> String? {
      return "üçøÎ∞ïÏä§Ïò§ÌîºÏä§(ÏòÅÌôîÏßÑÌù•ÏúÑÏõêÌöåÏ†úÍ≥µ:" + makeYesterdayString() + ")üçø"
  }
  
  func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -> UITableViewCell {
      let cell = tableView.dequeueReusableCell(withIdentifier: "myCell", for: indexPath) as! MyTableViewCell
      guard let mRank = movieData?.boxOfficeResult.dailyBoxOfficeList[indexPath.row].rank else { return UITableViewCell() }
      guard let mName = movieData?.boxOfficeResult.dailyBoxOfficeList[indexPath.row].movieNm else { return UITableViewCell() }
      
      cell.movieName.text = "[\(mRank)ÏúÑ] \(mName)"
      
      if let aCnt = movieData?.boxOfficeResult.dailyBoxOfficeList[indexPath.row].audiCnt {
          let numF = NumberFormatter()
          numF.numberStyle = .decimal
          let aCount = Int(aCnt)!
          let result = numF.string(for: aCount)! + "Î™Ö"
          cell.audiCount.text = "Ïñ¥Ï†ú: \(result)"
      }
      
      if let aAcc = movieData?.boxOfficeResult.dailyBoxOfficeList[indexPath.row].audiAcc {
          let numF = NumberFormatter()
          numF.numberStyle = .decimal
          let aAccum = Int(aAcc)!
          let result = numF.string(for: aAccum)! + "Î™Ö"
          cell.audiAccumulate.text = "ÎàÑÏ†Å: \(result)"
      }
      
      return cell
  }
  ```

#### Í≤∞Í≥º

![](/assets/img/post/25-05-14/7.png)
